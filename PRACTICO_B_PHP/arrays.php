<?php 
// creamos el array completo.
$alumno_asistencia_materia = array(
10 => array("nombre" => "ACOSTA CARLOS ALBERTO",
            "fechas" => array("30/09" => "-",
                              "06/10" => "-",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "p",
                              "20/10" => "p",
                              "21/10" => "p",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 37534790,
            "estado" => "Ac",
            "telefono" => 3704564895,
            "nota" => array("parcial 1" => 4,
                            "parcial 2" => 6,
                            "recuperatorio" => 7)),

29 => array("nombre" => "AGUILERA CAPRA JESUS DARIO",
            "fechas" => array("30/09" => "p",
                              "06/10" => "p",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "-",
                              "20/10" => "p",
                              "21/10" => "p",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 31072642,
            "estado" => "Ac",
            "telefono" => 3705238745,
            "nota" => array("parcial 1" => 7,
                            "parcial 2" => 6,
                            "recuperatorio" => null)),

34 => array("nombre" => "AYALA LEANDRO JOSE",
            "fechas" => array("30/09" => "p",
                              "06/10" => "-",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "p",
                              "20/10" => "-",
                              "21/10" => "p",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 31495856,
            "estado" => "Ac",
            "telefono" => 3704214589,
            "nota" => array("parcial 1" => 5,
                            "parcial 2" => 8,
                            "recuperatorio" => 5)),

45 => array("nombre" => "BENITEZ DARIO",
            "fechas" => array("30/09" => "p",
                              "06/10" => "p",
                              "07/10" => "p",
                              "13/10" => "-",
                              "14/10" => "p",
                              "20/10" => "p",
                              "21/10" => "p",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 28827535,
            "estado" => "Ac",
            "telefono" => 3718256489,
            "nota" => array("parcial 1" => 7,
                            "parcial 2" => 10,
                            "recuperatorio" => null)),

52 => array("nombre" => "BRITEZ PABLO FERNANDO",
            "fechas" => array("30/09" => "p",
                              "06/10" => "p",
                              "07/10" => "p",
                              "13/10" => "-",
                              "14/10" => "-",
                              "20/10" => "p",
                              "21/10" => "-",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 38573714,
            "estado" => "Ac",
            "telefono" => 3704564895,
            "nota" => array("parcial 1" => 9,
                            "parcial 2" => 9,
                            "recuperatorio" => null)),

65 => array("nombre" => "CANESIN LUIS OSCAR",
            "fechas" => array("30/09" => "p",
                              "06/10" => "-",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "p",
                              "20/10" => "-",
                              "21/10" => "p",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 20525869,
            "estado" => "Ac",
            "telefono" => 3705238745,
            "nota" => array("parcial 1" => 4,
                            "parcial 2" => 6,
                            "recuperatorio" => 10)),

79 => array("nombre" => "DEGREGORIO NICOLAS EZEQUIEL",
            "fechas" => array("30/09" => "p",
                              "06/10" => "p",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "p",
                              "20/10" => "p",
                              "21/10" => "p",
                              "27/10" => "-"),
            "condicion" => null,
            "dni" => 37535531,
            "estado" => "Ac",
            "telefono" => 3704214589,
            "nota" => array("parcial 1" => 9,
                            "parcial 2" => 6,
                            "recuperatorio" => null)),

84 => array("nombre" => "FERNANDEZ VICTOR HUGO",
            "fechas" => array("30/09" => "p",
                              "06/10" => "-",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "-",
                              "20/10" => "p",
                              "21/10" => "p",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 16969416,
            "estado" => "Ac",
            "telefono" => 3718256489,
            "nota" => array("parcial 1" => 8,
                            "parcial 2" => 9,
                            "recuperatorio" => null)),

9 => array("nombre" => "BOGADO EZEQUIEL",
            "fechas" => array("30/09" => "p",
                              "06/10" => "p",
                              "07/10" => "p",
                              "13/10" => "-",
                              "14/10" => "p",
                              "20/10" => "-",
                              "21/10" => "p",
                              "27/10" => "-"),
            "condicion" => null,
            "dni" => 39136464,
            "estado" => "Ac",
            "telefono" => 3704564895,
            "nota" => array("parcial 1" => 8,
                            "parcial 2" => 4,
                            "recuperatorio" => 9)),

103 => array("nombre" => "IZA FEDERICO",
            "fechas" => array("30/09" => "p",
                              "06/10" => "p",
                              "07/10" => "-",
                              "13/10" => "p",
                              "14/10" => "-",
                              "20/10" => "p",
                              "21/10" => "-",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 40084200,
            "estado" => "Ac",
            "telefono" => 3705238745,
            "nota" => array("parcial 1" => 9,
                            "parcial 2" => 6,
                            "recuperatorio" => null)),

117 => array("nombre" => "GIMENEZ MARIANA ITATI",
            "fechas" => array("30/09" => "p",
                              "06/10" => "-",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "p",
                              "20/10" => "p",
                              "21/10" => "-",
                              "27/10" => "-"),
            "condicion" => null,
            "dni" => 39133013,
            "estado" => "Ac",
            "telefono" => 3704214589,
            "nota" => array("parcial 1" => 9,
                            "parcial 2" => 9,
                            "recuperatorio" => null)),

124 => array("nombre" => "BRITEZ MENDEL JUNIOR JOEL",
            "fechas" => array("30/09" => "p",
                              "06/10" => "p",
                              "07/10" => "p",
                              "13/10" => "p",
                              "14/10" => "p",
                              "20/10" => "-",
                              "21/10" => "p",
                              "27/10" => "p"),
            "condicion" => null,
            "dni" => 5038619,
            "estado" => "Ac",
            "telefono" => 3718256489,
            "nota" => array("parcial 1" => 5,
                            "parcial 2" => 5,
                            "recuperatorio" => 4)),

);

// calculamos el promedio de cada alumno 
$promedio_notas = array();
foreach ($alumno_asistencia_materia as $id => $alumno) {
    $suma=0;
    foreach ($alumno['nota'] as $nota => $valor) {
        if ($valor != null) {
            $suma = $suma + $valor;
            $promedio_notas[$id] = ($suma/count($alumno['nota']));
        }else{
            $suma = $suma + $valor;
            $promedio_notas[$id] = ($suma/2);
        }
}
} 

// imprimimos los valores
/* foreach ($promedio_notas as $id => $nota) {
    echo $nota.",<br> ";
} */

// calculamos la cantidad de aucentes de cada alumno
$contador_asistencia = array();
foreach ($alumno_asistencia_materia as $id => $alumno) {
    $contador=0;
    foreach ($alumno['fechas'] as $fecha => $valor) {
        if ($valor != 'p') {
            $contador = $contador + 1;
            $contador_asistencia[$id] = $contador;
        }
}
} 
// mostramos los valores 
/* foreach ($contador_asistencia as $id => $asistencia) {
    echo $asistencia.",<br> ";
} */

// creamos una funciÃ³n para la condicion de cada alumno
function establecerCondicion(&$alumnos, $promedios, $inasistencias) {
    foreach ($alumnos as $id => $alumno) {
        if ($promedios[$id]<6 || $inasistencias[$id]>2) {
            $alumnos[$id]['condicion']="LIBRE";
        } elseif ($promedios[$id]<8) {
            $alumnos[$id]['condicion']="REGULAR";
        } else {
            $alumnos[$id]['condicion']="PROMOCIONAL";
        }
    }
}
// ejecutamos la funcion
establecerCondicion($alumno_asistencia_materia, $promedio_notas, $contador_asistencia);

// calculamos el porcentaje de alumnos LIBRES 
$porcentaje_libre = 0;
$contador_libre = 0;
foreach ($alumno_asistencia_materia as $id => $alumno) {
    if ($alumno['condicion'] === "LIBRE") {
        $contador_libre = $contador_libre + 1;
    }
}
$porcentaje_libre = ($contador_libre*100)/count($alumno_asistencia_materia);
// calculamos el porcentaje de alumnos REGULARES 
$porcentaje_regular = 0;
$contador_regular = 0;
foreach ($alumno_asistencia_materia as $id => $alumno) {
    if ($alumno['condicion'] === "REGULAR") {
        $contador_regular = $contador_regular + 1;
    }
}
$porcentaje_regular = ($contador_regular*100)/count($alumno_asistencia_materia);
// calculamos el porcentaje de alumnos PROMOCIONALES
$porcentaje_promocional = 0;
$contador_promocional = 0;
foreach ($alumno_asistencia_materia as $id => $alumno) {
    if ($alumno['condicion'] === "PROMOCIONAL") {
        $contador_promocional = $contador_promocional + 1;
    }
}
$porcentaje_promocional = ($contador_promocional*100)/count($alumno_asistencia_materia);

if (isset($_POST['filtro'])) {
$input = $_POST['fecha'];

$filtro_fecha = array();

include("header.php");
echo "<div class='col-md-5'>";
 echo "<table class='table table-bordered table-sm text-dark text-center'>
 <thead>
 <th>Fecha: $input</th>";
 echo "</thead>
 <tbody>";
 
        foreach ($alumno_asistencia_materia as $id => $alumno) {
            echo "<tr>";
            echo "<td>" . $alumno['nombre'] . "</td>";
            foreach ($alumno['fechas'] as $fecha => $valor) {
                if ($fecha == $input) {
                    $filtro_fecha[$id] = $valor;
                    echo "<td>" . $filtro_fecha[$id] . "</td>";
                    echo "</tr>";
                }
        }
    }
echo "</tbody>
</table>";
echo "</div>";
include("footer.php");
//print_r($filtro_fecha);
}



?>